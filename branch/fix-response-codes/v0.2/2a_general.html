<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>General Protocol Concept | ThingSet Protocol Specification</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="apple-touch-icon" sizes="180x180" href="/thingset/branch/fix-response-codes/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/thingset/branch/fix-response-codes/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/thingset/branch/fix-response-codes/favicons/favicon-16x16.png">
    <link rel="manifest" href="/thingset/branch/fix-response-codes/favicons/site.webmanifest">
    <link rel="mask-icon" href="/thingset/branch/fix-response-codes/favicons/safari-pinned-tab.svg" color="#5bbad5">
    <link rel="shortcut icon" href="/thingset/branch/fix-response-codes/favicons/favicon.ico">
    <meta name="description" content="The ThingSet protocol provides a consistent, standardized way to configure, monitor and control ressource-constrained devices via different communication interfaces like Serial, LoRa, USB, Bluetooth or CAN.">
    <meta name="msapplication-TileColor" content="#2b5797">
    <meta name="msapplication-config" content="/favicons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    
    <link rel="preload" href="/thingset/branch/fix-response-codes/assets/css/0.styles.ce8b9ea9.css" as="style"><link rel="preload" href="/thingset/branch/fix-response-codes/assets/js/app.cd3fade1.js" as="script"><link rel="preload" href="/thingset/branch/fix-response-codes/assets/js/2.255dc49b.js" as="script"><link rel="preload" href="/thingset/branch/fix-response-codes/assets/js/3.cbbcd511.js" as="script"><link rel="preload" href="/thingset/branch/fix-response-codes/assets/js/12.2e5a3608.js" as="script"><link rel="prefetch" href="/thingset/branch/fix-response-codes/assets/js/10.7e36c70c.js"><link rel="prefetch" href="/thingset/branch/fix-response-codes/assets/js/11.713ee545.js"><link rel="prefetch" href="/thingset/branch/fix-response-codes/assets/js/13.05812ad0.js"><link rel="prefetch" href="/thingset/branch/fix-response-codes/assets/js/14.2ad60313.js"><link rel="prefetch" href="/thingset/branch/fix-response-codes/assets/js/15.639990eb.js"><link rel="prefetch" href="/thingset/branch/fix-response-codes/assets/js/16.0d5bf815.js"><link rel="prefetch" href="/thingset/branch/fix-response-codes/assets/js/17.5f7b45e0.js"><link rel="prefetch" href="/thingset/branch/fix-response-codes/assets/js/18.3a107509.js"><link rel="prefetch" href="/thingset/branch/fix-response-codes/assets/js/19.014c8a63.js"><link rel="prefetch" href="/thingset/branch/fix-response-codes/assets/js/20.dc2afa9a.js"><link rel="prefetch" href="/thingset/branch/fix-response-codes/assets/js/21.40277f37.js"><link rel="prefetch" href="/thingset/branch/fix-response-codes/assets/js/22.10f60380.js"><link rel="prefetch" href="/thingset/branch/fix-response-codes/assets/js/23.68046227.js"><link rel="prefetch" href="/thingset/branch/fix-response-codes/assets/js/24.bac62e78.js"><link rel="prefetch" href="/thingset/branch/fix-response-codes/assets/js/25.de0d830e.js"><link rel="prefetch" href="/thingset/branch/fix-response-codes/assets/js/26.a64e85d1.js"><link rel="prefetch" href="/thingset/branch/fix-response-codes/assets/js/27.4eaf1a67.js"><link rel="prefetch" href="/thingset/branch/fix-response-codes/assets/js/28.ccc37a9e.js"><link rel="prefetch" href="/thingset/branch/fix-response-codes/assets/js/29.87358aac.js"><link rel="prefetch" href="/thingset/branch/fix-response-codes/assets/js/4.c8346c1b.js"><link rel="prefetch" href="/thingset/branch/fix-response-codes/assets/js/5.9ad8f383.js"><link rel="prefetch" href="/thingset/branch/fix-response-codes/assets/js/6.9672f0a7.js"><link rel="prefetch" href="/thingset/branch/fix-response-codes/assets/js/7.7a6c901b.js"><link rel="prefetch" href="/thingset/branch/fix-response-codes/assets/js/8.32893b9d.js"><link rel="prefetch" href="/thingset/branch/fix-response-codes/assets/js/9.1d02729e.js">
    <link rel="stylesheet" href="/thingset/branch/fix-response-codes/assets/css/0.styles.ce8b9ea9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/thingset/branch/fix-response-codes/" class="home-link router-link-active"><img src="/thingset/branch/fix-response-codes/favicons/apple-touch-icon.png" alt="ThingSet Protocol Specification" class="logo"> <span class="site-name">ThingSet Protocol Specification</span></a> <div class="links"><div class="search-box can-hide"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="History Menu" class="dropdown-title"><span class="title">History</span> <span class="arrow down"></span></button> <button type="button" aria-label="History Menu" class="mobile-dropdown-title"><span class="title">History</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/thingset/branch/fix-response-codes/" class="nav-link">
  v0.3
</a></li><li class="dropdown-item"><!----> <a href="/thingset/branch/fix-response-codes/v0.2/" class="nav-link router-link-active">
  v0.2
</a></li><li class="dropdown-item"><!----> <a href="/thingset/branch/fix-response-codes/v0.1/" class="nav-link">
  v0.1
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="History Menu" class="dropdown-title"><span class="title">History</span> <span class="arrow down"></span></button> <button type="button" aria-label="History Menu" class="mobile-dropdown-title"><span class="title">History</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/thingset/branch/fix-response-codes/" class="nav-link">
  v0.3
</a></li><li class="dropdown-item"><!----> <a href="/thingset/branch/fix-response-codes/v0.2/" class="nav-link router-link-active">
  v0.2
</a></li><li class="dropdown-item"><!----> <a href="/thingset/branch/fix-response-codes/v0.1/" class="nav-link">
  v0.1
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Why ThingSet?</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/thingset/branch/fix-response-codes/" aria-current="page" class="sidebar-link">Introduction</a></li><li><a href="/thingset/branch/fix-response-codes/1b_existing_solutions.html" class="sidebar-link">Existing Standards</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Application Layer</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/thingset/branch/fix-response-codes/2a_general.html" class="sidebar-link">General Concept</a></li><li><a href="/thingset/branch/fix-response-codes/2b_text_mode.html" class="sidebar-link">Text Mode</a></li><li><a href="/thingset/branch/fix-response-codes/2c_binary_mode.html" class="sidebar-link">Binary Mode</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Lower Layers</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/thingset/branch/fix-response-codes/3a_serial.html" class="sidebar-link">Serial</a></li><li><a href="/thingset/branch/fix-response-codes/3b_can.html" class="sidebar-link">CAN</a></li><li><a href="/thingset/branch/fix-response-codes/3c_lora.html" class="sidebar-link">LoRa</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Protocol Mapping</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/thingset/branch/fix-response-codes/4a_http.html" class="sidebar-link">HTTP</a></li><li><a href="/thingset/branch/fix-response-codes/4b_coap.html" class="sidebar-link">CoAP</a></li><li><a href="/thingset/branch/fix-response-codes/4c_mqtt.html" class="sidebar-link">MQTT</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="general-protocol-concept"><a href="#general-protocol-concept" class="header-anchor">#</a> General Protocol Concept</h1> <p>The ThingSet protocol provides a consistent, standardized way to configure, monitor and control ressource-constrained devices via different communication interfaces. It specifies the higher layers (5 to 7) of the <a href="https://en.wikipedia.org/wiki/OSI_model" target="_blank" rel="noopener noreferrer">OSI (Open Systems Interconnection) model<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. The payload data is independent of the underlying lower layer protocol or interface, which can be CAN, USB, LoRa, WiFi, Bluetooth, UART (serial) or similar.</p> <p><img src="/thingset/branch/fix-response-codes/assets/img/osi_layers.67f8a7c8.png" alt="ISO/OSI layer setup"></p> <p>The underlying layers have to ensure encryption, reliable transfer, correct packet order (if messages are packetized) and error-checking of the transferred data.</p> <h2 id="message-types"><a href="#message-types" class="header-anchor">#</a> Message Types</h2> <p>ThingSet defines three types of messages: Requests, responses and publication messages.</p> <h3 id="request-response-or-client-server-model"><a href="#request-response-or-client-server-model" class="header-anchor">#</a> Request/response or client/server model</h3> <p>The communication between two specific devices uses a request/response messaging pattern via so-called channels. A communication channel can be established either directly (e.g. serial interface, USB, Bluetooth) or via a network or bus with several devices attached (e.g. CAN, Ethernet, WiFi, LoRa). In case of a network, each device/node has to be uniquely addressable.</p> <p><img src="/thingset/branch/fix-response-codes/assets/img/communication_channels.e239da73.png" alt="Communication Channels"></p> <p>The device acts as the server and responds to the requests by a client. The client might be a laptop or mobile phone with a human interface application.</p> <p>The data transfer is always synchronous: The client sends a request, waits for the response (status code and/or requested data), handles the data of the response and possibly starts with additional requests.</p> <h3 id="publication-messages"><a href="#publication-messages" class="header-anchor">#</a> Publication messages</h3> <p>Monitoring data is not intended for only a single device, but could be interesting for several devices (e.g. data logger, display, human interface device, etc.). Thus, the monitoring data is exchanged via a publish/subscribe messaging pattern.</p> <p>Publication messages are directly broadcast through the network. There is <em>no</em> intermediate broker (like in MQTT) to store the messages and published messages are <em>not</em> confirmed by recipients, so there is no guarantee if the message was received.</p> <h2 id="protocol-modes"><a href="#protocol-modes" class="header-anchor">#</a> Protocol Modes</h2> <p>Similar to Modbus, the ThingSet protocol supports two different modes: A human-readable text mode and a binary mode.</p> <p>In the text mode, payload data is encoded in JSON format (<a href="https://tools.ietf.org/html/rfc8259" target="_blank" rel="noopener noreferrer">RFC 8259<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>). This mode is recommended when using USB or serial interfaces as the low layer protocol, as it can be easily used directly on a terminal.</p> <p>The binary protocol uses the CBOR binary encoding (<a href="https://tools.ietf.org/html/rfc7049" target="_blank" rel="noopener noreferrer">RFC 7049<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>) instead of JSON payload data in order to reduce the protocol overhead for ressource-constrained devices or low bandwith communication protocols like CAN and LoRa.</p> <p>Each device must implement the binary encoding of the protocol. The the text-based JSON variant is optional, but recommended.</p> <h2 id="data-objects"><a href="#data-objects" class="header-anchor">#</a> Data Objects</h2> <p>All accessible data of a device is structured in so-called data objects. A data object might be any kind of measurements (e.g. temperature), device configuration (e.g. setpoint of a controller) or similar.</p> <p>Each data object is identified by a unique Data Object ID. The ID can be chosen by the firmware developer. In addition to that, each data object has a unique name. The name is a short case-sensitive ASCII string without blanks. If applicable, the unit is appended with an underscore, e.g. &quot;Bat_V&quot; for the battery voltage or &quot;Manufacturer&quot; (without a unit). The underscore is only allowed to separate the name and the unit, there is no additional underscore allowed in the name.</p> <p>The numeric IDs are used in the binary protocol to reduce message length. For all interactions with users and in the text-based mode, only the object name is used.</p> <h3 id="data-object-categories"><a href="#data-object-categories" class="header-anchor">#</a> Data object categories</h3> <p>Each data object belongs to one of the following categories:</p> <table><thead><tr><th>Category</th> <th>Description</th> <th>Access</th></tr></thead> <tbody><tr><td>info</td> <td>Device information (e.g. manufacturer, software version)</td> <td>read access</td></tr> <tr><td>conf</td> <td>Configurable settings, stored in non-volatile memory after change</td> <td>read/write access, may be protected with user password</td></tr> <tr><td>input</td> <td>Input channels (e.g. actuators)</td> <td>write access</td></tr> <tr><td>output</td> <td>Output channels (e.g. sensor data)</td> <td>read access</td></tr> <tr><td>rec</td> <td>Recorded (history-dependent) data (e.g. error counters)</td> <td>read access, restricted write access to reset</td></tr> <tr><td>cal</td> <td>Factory-calibrated settings</td> <td>read/write access, protected</td></tr> <tr><td>exec</td> <td>Executable data (remote procedure call)</td> <td>partly access restricted</td></tr></tbody></table> <p>The input and output channels are used for instantaneous data. Changes to an input data object are only stored in RAM, so they get lost after a reset of the device. In contrast to that, conf data is stored in non-volatile memory (e.g. flash or EEPROM) after a change. As non-volatile memory has a limited amount of write cycles, configuration data should not be changed continously.</p> <p>The recorded data category is used for history-dependent data like error memory, energy counters or min/max values of certain measurements. In contrast to data of <em>output</em> category, recorded data cannot be obtained through measurement after reset, so the current state has to be stored in non-volatile memory on a regular basis.</p> <p>Factory calibration is only accessible for the manufacturer after authentication.</p> <p>Excecutable data means that they trigger a function call in the device firmware. Currently, only void functions without any parameters are supported.</p> <p>Data object IDs are stored as unsigned integers. The firmware developer should assign the lowest IDs to the most used data objects, as they consume less bytes during transfer (see CBOR representation of unsigned integers).</p> <h3 id="examples"><a href="#examples" class="header-anchor">#</a> Examples</h3> <p>For explanation of the protocol functions, the following exemplary device data objects will be used:</p> <table><thead><tr><th>Data Object ID</th> <th>Name</th> <th>Value</th> <th>Category</th></tr></thead> <tbody><tr><td>0x01</td> <td>Manufacturer</td> <td>&quot;Test Company Inc.&quot;</td> <td>info</td></tr> <tr><td>0x02</td> <td>EnableSwitch</td> <td>true</td> <td>input</td></tr> <tr><td>0x03</td> <td>Bat_V</td> <td>14.2</td> <td>output</td></tr> <tr><td>0x04</td> <td>Ambient_degC</td> <td>22</td> <td>output</td></tr></tbody></table> <p>The above data structure contains 4 data objects in total, grouped into 3 different categories (info, input and output). The device will have an internal map to associate the object name, unique ID, category and a pointer to the variable containing the actual data.</p> <h3 id="units"><a href="#units" class="header-anchor">#</a> Units</h3> <p>All data communicated with the outside world use <a href="https://en.wikipedia.org/wiki/International_System_of_Units" target="_blank" rel="noopener noreferrer">SI units<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and the different numeric data types should be used for scaling instead of prefixes like <em>milli</em> or <em>kilo</em> to the units.</p> <p>If the basic SI unit for a given measurement value is not common or not feasible (e.g. use of kWh for energy instead of Ws), the unit must be properly defined with an underscore in the name of the data object, e.g. &quot;Battery_kWh&quot; for the battery energy content in kWh. Units which cannot be derived from the SI basic units (e.g. Â°F) are not recommended.</p> <h2 id="functions"><a href="#functions" class="header-anchor">#</a> Functions</h2> <p>Each request fulfills a specified function, e.g. a command to read data from the device. The function is associated to a function ID, which defines the layout of the payload and the actions to be performed.</p> <p>The different functions are encoded in the first byte of a message, i.e. by a number between 0 and 255.</p> <p>Function IDs 10, 13 and 32-127 are reserved, as they represent the ASCII characters for readable text including CR and LF. Invalid function IDs are ignored by the ThingSet parser, so that other text output (e.g. status information) can be used in parallel to the ThingSet protocol on the same serial interface.</p> <p>The ASCII characters '!', '#' and ':' (function IDs 33, 35 and 58) are used as identifiers for the text mode protocol. In this way, text-based or binary mode can be automatically detected based on the first byte.</p> <p>Function IDs greater than or equal to 128 (0x80) are used for response messages and include a status code which shows if the request could be handled successfully. The function ID is calculated as 0x80 + status code. For status codes between 0 and 31, the response was successful. If the status code is greater than or equal to 32, an error occured.</p> <p>Details regarding the ThingSet Protocol functions will be explained in the next chapter.</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">4/15/2020, 4:18:48 PM</span></div></footer> <!---->  <div class="footer">
    Content provided by <a href="https://libre.solar">Libre Solar</a> under <a href="https://creativecommons.org/licenses/by-sa/4.0/legalcode">CC-BY-SA 4.0 License</a> | <a href="https://libre.solar/about/contact/">Contact / Impressum</a></div></main></div><div class="global-ui"></div></div>
    <script src="/thingset/branch/fix-response-codes/assets/js/app.cd3fade1.js" defer></script><script src="/thingset/branch/fix-response-codes/assets/js/2.255dc49b.js" defer></script><script src="/thingset/branch/fix-response-codes/assets/js/3.cbbcd511.js" defer></script><script src="/thingset/branch/fix-response-codes/assets/js/12.2e5a3608.js" defer></script>
  </body>
</html>
